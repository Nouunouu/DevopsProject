pipeline {
    agent any  // Run on any available node
    tools {
        maven 'M2_HOME'  // Ensure this matches your Maven tool configuration in Jenkins
    }
    options {
        timeout(time: 30, unit: 'MINUTES')  // Increased timeout
    }
    environment {
        APP_ENV = "DEV"
    }
    stages {
        stage('Checkout Code') {
            steps {
                script {
                    // Checkout the 'Oussema' branch from the repository
                    checkout([
                        $class: 'GitSCM',
                        branches: [[name: 'Oussema']],  // Specify the branch name here
                        userRemoteConfigs: [[url: 'https://github.com/Nouunouu/DevopsProject.git']]  // Replace with your repository URL
                    ])
                }
            }
        }
        stage('Code Build') {
            steps {
                sh '''
                    # Navigate to the directory containing the pom.xml file
                    cd kaddem/kaddem
                    # Run Maven commands
                    mvn clean package -Dmaven.test.skip=true
                    mvn install -Dmaven.test.skip=true
                '''
            }
        }
        stage('SonarQube') {
            steps {
                sh 'mvn sonar:sonar -Dsonar.token=squ_75ec5f123179a9c2f52a8d9c5ae0095c0fc883a6 -Dmaven.test.skip=true';
            }
        }
    }
    post {
        always {
            echo "======always======"
        }
        success {
            echo "=====pipeline executed successfully ====="
        }
        failure {
            echo "======pipeline execution failed======"
        }
    }
}